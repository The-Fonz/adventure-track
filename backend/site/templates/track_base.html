{% extends "base.html" %}

{% block title %}
adventure-track
{% endblock %}

{% block head %}
<link href="/static/vis.css" rel="stylesheet" type="text/css" />
{# Prevent zoom #}
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<link href="http://vjs.zencdn.net/5.17.0/video-js.css" rel="stylesheet">
<link href='https://api.mapbox.com/mapbox-gl-js/v0.32.1/mapbox-gl.css' rel='stylesheet' />
{# Allow stylesheets to be overridden by parent ones #}
{{ super() }}
{% endblock %}

{% block base_body %}

<nav class="nav has-shadow"
    {# Quick hack #}
    style="position:fixed; left:0;right:0;">
    <div class="nav-left is-hidden-mobile">
      <a class="nav-item" href="/">
        <span>Adventure-Track</span>
      </a>
      <!--<a class="nav-item is-tab is-hidden-mobile is-active">Home</a>-->
      <!--<a class="nav-item is-tab is-hidden-mobile">Features</a>-->
      <!--<a class="nav-item is-tab is-hidden-mobile">Pricing</a>-->
      <!--<a class="nav-item is-tab is-hidden-mobile">About</a>-->
    </div>
      <div class="nav-center">
          <span class="nav-item">
          {% if user %}
            <span>{{user.first_name}} {{user.last_name}} personal tracking page</span>
          {% elif adventure %}
            <span>{{adventure.name}}</span>
          {% endif %}
          </span>
      </div>
    <!--<span class="nav-toggle">-->
      <!--<span></span>-->
      <!--<span></span>-->
      <!--<span></span>-->
    <!--</span>-->
    {# Bulma needs a nav-right to center nav-center #}
    <div class="nav-right"></div>
    <!--<div class="nav-right nav-menu">-->
      <!--<a class="nav-item is-tab is-hidden-tablet is-active">Home</a>-->
      <!--<a class="nav-item is-tab is-hidden-tablet">Features</a>-->
      <!--<a class="nav-item is-tab is-hidden-tablet">Pricing</a>-->
      <!--<a class="nav-item is-tab is-hidden-tablet">About</a>-->
      <!--<a class="nav-item is-tab">-->
        <!--<figure class="image is-16x16" style="margin-right: 8px;">-->
          <!--<img src="http://bulma.io/images/jgthms.png">-->
        <!--</figure>-->
        <!--Profile-->
      <!--</a>-->
      <!--<a class="nav-item is-tab">Log out</a>-->
</nav>

<div class="columns panes"
     {# Quick hack #}
    style="margin-top:3.25rem; position:relative; height:calc(100% - 3.25rem);">
    {# Hide on mobile for now, should use tabs instead #}
    <div class="column leftpane is-half-tablet is-two-thirds-desktop is-hidden-mobile is-unselectable">
        <div id="map-view">
            <section class="hero is-medium is-primary is-bold"
            {# Quick hack #}
            style="height: calc(100vh - 150px - 3.25rem);">
              <div class="hero-body" style="padding-top:0;padding-bottom:0;height:100%;">
                <div class="container" style="position:relative;top:50%;transform:translateY(-50%);">
                  <h1 class="title">
                    Map coming soon!
                  </h1>
                  <h2 class="subtitle">
                    <i>We're working on it.</i>
                  </h2>
                </div>
              </div>
            </section>
        </div>
        <div id="timeline"></div>
    </div>
    <div class="column rightpane">
        <div id="blog">
            <div class="loader"></div>
        </div>
    </div>
</div>

<div id="overlay"></div>

{# Avoid jinja2 parsing this Ractive template #}
{% raw %}
<template id="overlay-template">
    {{#if visible}}
    <div fade-in class="modal is-active">
        <div class="modal-background" on-click="@this.close()"></div>
        <div class="content">
            {{#if vidsrc}}
            <video autoplay controls src="{{vidsrc}}"></video>
            {{/if}}
            {{#if imgsrc}}
            <img src="{{imgsrc}}" />
            {{/if}}
        </div>
        <button class="modal-close" on-click="@this.close()"></button>
    </div>
    {{/if}}
</template>

<template id="blog-template">
    <div>
        {{#messagesLoadError}}
        <div class="notification is-danger">
          <button class="delete" on-click="@this.set('messagesLoadError', null)"></button>
          {{messagesLoadError}}
        </div>
        {{/messagesLoadError}}
        {{#messages}}
        <div fade-in="{duration: 800}" class="card message">
            {{#if media.image || media.video}}
            <div class="card-image" on-click="show">
                <figure class="image mediathumb">
                    {{#if media.image}}
                    <div class="imgthumbwrapper">
                        <img class="imgthumb" src="/media/{{media.image.thumb.path}}" />
                    </div>
                    {{/if}}
                    {{#if media.video}}
                    <div class="vidthumbwrapper">
                        <img class="vidthumb" src="/media/{{media.video.thumb.path}}" />
                    </div>
                    {{/if}}
                </figure>
            </div>
            {{/if}}
            {{#if media.audio}}
            <div class="card-audio">
                <audio src="/media/{{media.audio.std.path}}" >
                    Your browser does not support the <code>audio</code> element.
                </audio>
            </div>
            {{/if}}
            <div class="card-content">
                <div class="media">
                    <div class="media-left">
                        <figure class="image is-48x48">
                            <img src="/static/profilepic-placeholder.png" alt="Image">
                        </figure>
                    </div>
                    <div class="media-content">
                        <p class="title is-4">{{users[this.user_id].first_name}} {{users[this.user_id].last_name}}</p>
                        <!--<p class="subtitle is-6">@johnsmith</p>-->
                    </div>
                </div>

                <div class="content">
                    {{this.text}}
                    <br>
                    <small>{{this.timestamp.calendar(null,{sameElse: 'ddd MMM Do YYYY HH:mm'})}}</small>
                </div>
            </div>
            <footer class="card-footer">
                <p on-click="@this.like(this.id)" class-liked="{{likes[this.id]}}" class="card-footer-item msglike">
                    <span>
                        <i class="fa fa-heart" aria-hidden="true"></i>
                    </span>
                </p>
            </footer>
        </div>
        {{/messages}}
    </div>
</template>
{% endraw %}

<script src="/static/bundle.js"></script>

{% endblock %}
