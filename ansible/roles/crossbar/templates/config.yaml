version: 2
controller: {}
workers:
- type: router
  realms:
  - name: realm1
    roles:
    - name: backend
      permissions:
      - uri: ''
        match: prefix
        allow:
          call: true
          register: true
          publish: true
          subscribe: true
        disclose:
          caller: false
          publisher: false
        cache: true
    - name: frontend
      permissions:
      - uri: 'at.messages.fetchmsgs'
        match: exact
        allow:
          call: true
          register: false
          publish: false
          subscribe: false
        disclose:
          caller: false
          publisher: false
        cache: true
      - uri: 'at.messages.user.'
        match: prefix
        allow:
          call: false
          register: false
          publish: false
          subscribe: true
        disclose:
          caller: false
          publisher: false
        cache: true
  transports:
  - type: web
    endpoint:
      type: tcp
      port: 8080
    paths:
      ws:
        type: websocket
        auth:
          anonymous:
            type: static
            role: frontend
          ticket:
            type: static
            principals:
              backend:
                ticket: "${AT_INTERNAL_TICKET}"
                role: backend
